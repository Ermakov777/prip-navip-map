<script>
  // URL твоего Cloudflare Worker
  const CHECK_URL = "https://11.ermakovnd88.workers.dev/check-telegram";

  async function loginWithTelegram(initData) {
    try {
      const res = await fetch(CHECK_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ initData }),
      });

      if (!res.ok) {
        throw new Error("Ошибка проверки");
      }

      const data = await res.json();

      if (data.role === "admin") {
        alert("Добро пожаловать, админ!");
        document.body.classList.add("is-admin");
      } else {
        alert("Вход как пользователь");
        document.body.classList.add("is-user");
      }
    } catch (err) {
      alert("Сетевая ошибка проверки: " + err.message);
    }
  }

  // Инициализация Telegram WebApp
  window.Telegram.WebApp.ready();
  const initData = window.Telegram.WebApp.initData;
  if (initData) {
    loginWithTelegram(initData);
  }
</script>
